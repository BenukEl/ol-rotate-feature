/*!
OpenLayers 3 rotate interaction.
Allows vector feature rotation.

@package ol3-rotate-feature
@author Vladimir Vershinin <ghettovoice@gmail.com>
@version 1.0.0
@licence MIT https://opensource.org/licenses/MIT
         Based on OpenLayers 3. Copyright 2005-2016 OpenLayers Contributors. All rights reserved. http://openlayers.org
@copyright (c) 2016, Vladimir Vershinin <ghettovoice@gmail.com>
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ol")):"function"==typeof define&&define.amd?define(["ol"],t):"object"==typeof exports?exports.ol3RotateFeature=t(require("ol")):e.ol3RotateFeature=t(e.ol)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/dist/",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RotateFeatureEventType=t.RotateFeatureEvent=t.RotateFeatureInteraction=void 0;var o=r(3),a=n(o),i=r(1);t.RotateFeatureInteraction=a["default"],t.RotateFeatureEvent=i.RotateFeatureEvent,t.RotateFeatureEventType=i.RotateFeatureEventType},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RotateFeatureEvent=t.RotateFeatureEventType=void 0;var u=r(2),s=n(u);t.RotateFeatureEventType={START:"rotatestart",ROTATING:"rotating",END:"rotateend"},t.RotateFeatureEvent=function(e){function t(e,r){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this,e));return n.features=r,n}return i(t,e),t}(s["default"])},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t,n){r(this,e),this.propagationStopped=void 0,this.type=t,this.target=n||null}return n(e,[{key:"preventDefault",value:function(){this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),e}();o.stopPropagation=function(e){e.stopPropagation()},o.preventDefault=function(e){e.preventDefault()},t["default"]=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});return!t||this.lastCoordinate_||!this.features_.getArray().includes(t)&&t!==this.arrowFeature_?t&&t===this.anchorFeature_?(this.anchorMoving_=!0,f.call(this,e),!0):!1:(this.lastCoordinate_=e.coordinate,f.call(this,e),this.dispatchEvent(new F.RotateFeatureEvent(F.RotateFeatureEventType.START,this.features_)),!0)}function l(e){return this.lastCoordinate_?(this.lastCoordinate_=void 0,f.call(this,e),this.dispatchEvent(new F.RotateFeatureEvent(F.RotateFeatureEventType.END,this.features_)),!0):this.anchorMoving_?(this.anchorMoving_=!1,f.call(this,e),!0):!1}function c(e){var t=this,r=e.coordinate,n=this.anchorFeature_.getGeometry().getCoordinates(),o=function(e,r){return e.set(t.angleProperty_,(e.get(t.angleProperty_)||0)+r)};if(this.lastCoordinate_)!function(){var a=[t.lastCoordinate_[0]-n[0],t.lastCoordinate_[1]-n[1]],i=[r[0]-n[0],r[1]-n[1]],u=Math.atan2(a[0]*i[1]-i[0]*a[1],a[0]*i[0]+a[1]*i[1]);t.features_.forEach(function(e){e.getGeometry().rotate(u,n),o(e,u)}),[t.anchorFeature_,t.arrowFeature_].forEach(function(e){return o(e,u)}),t.dispatchEvent(new F.RotateFeatureEvent(F.RotateFeatureEventType.ROTATING,t.features_)),t.lastCoordinate_=e.coordinate}();else if(this.anchorMoving_){var a=r[0]-n[0],i=r[1]-n[1];this.anchorFeature_.getGeometry().translate(a,i),this.arrowFeature_.getGeometry().translate(a,i),this.features_.forEach(function(e){return e.set(t.anchorProperty_,r)})}}function f(e){var t=e.map.getTargetElement(),r=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e}),n=function(e){var r=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];r&&(t.style.cursor="-webkit-"+e,t.style.cursor="-moz-"+e),t.style.cursor=e};this.lastCoordinate_?(this.previousCursor_=t.style.cursor,n("grabbing",!0)):r&&(this.features_.getArray().includes(r)||r===this.arrowFeature_)?(this.previousCursor_=t.style.cursor,n("grab",!0)):r&&r===this.anchorFeature_||this.anchorMoving_?(this.previousCursor_=t.style.cursor,n("crosshair")):(n(this.previousCursor_||""),this.previousCursor_=void 0)}function h(e){var t,r=[255,255,255,.8],n=[0,153,255,.8],a=[255,255,255,.01],i=2,u=(t={},o(t,w,[new _["default"].style.Style({image:new _["default"].style.RegularShape({fill:new _["default"].style.Fill({color:[0,153,255,.8]}),stroke:new _["default"].style.Stroke({color:n,width:1}),radius:4,points:6}),zIndex:1/0})]),o(t,b,[new _["default"].style.Style({fill:new _["default"].style.Fill({color:a}),stroke:new _["default"].style.Stroke({color:r,width:i+2}),text:new _["default"].style.Text({font:"12px sans-serif",offsetX:20,offsetY:-20,fill:new _["default"].style.Fill({color:"blue"}),stroke:new _["default"].style.Stroke({color:r,width:i+1})}),zIndex:1/0}),new _["default"].style.Style({fill:new _["default"].style.Fill({color:a}),stroke:new _["default"].style.Stroke({color:n,width:i}),zIndex:1/0})]),t);return function(t,r){var n,o=t.get(e)||0;switch(!0){case t.get(w):return n=u[w],n[0].getImage().setRotation(-o),n;case t.get(b):n=u[b];var a=t.getGeometry().getCoordinates(),i=new _["default"].geom.Polygon([[[a[0],a[1]-6*r],[a[0]+8*r,a[1]-12*r],[a[0],a[1]+30*r],[a[0]-8*r,a[1]-12*r],[a[0],a[1]-6*r]]]);return i.rotate(o,a),n[0].setGeometry(i),n[1].setGeometry(i),n[0].getText().setText(Math.round(180*-o/Math.PI)+"Â°"),n}}}function d(e){return new _["default"].geom.GeometryCollection((Array.isArray(e)?e:e.getArray()).map(function(e){return e.getGeometry()})).getExtent()}Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),y=function E(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var o=Object.getPrototypeOf(e);return null===o?void 0:E(o,t,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},v=r(5),_=n(v),g=r(4),F=r(1),w="anchor",b="arrow",m=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,t);var r=i(this,Object.getPrototypeOf(t).call(this,{handleEvent:t.handleEvent,handleDownEvent:s,handleUpEvent:l,handleDragEvent:c,handleMoveEvent:f}));return r.features_=e.features,(0,g.assertInstanceOf)(r.features_,_["default"].Collection),r.angleProperty_=e.angleProperty||"angle",r.anchorProperty_=e.anchorProperty||"anchor",r.overlay_=new _["default"].layer.Vector({style:e.style||h.call(r,r.angleProperty_),source:new _["default"].source.Vector({features:new _["default"].Collection})}),r.previousCursor_=void 0,r.anchorFeature_=void 0,r.arrowFeature_=void 0,r.lastCoordinate_=void 0,r.anchorMoving_=!1,r.featuresExtent_=void 0,r.features_.on("add",r.handleFeatureAdd_,r),r.features_.on("remove",r.handleFeatureRemove_,r),r}return u(t,e),p(t,[{key:"setMap",value:function(e){this.overlay_.setMap(e),y(Object.getPrototypeOf(t.prototype),"setMap",this).call(this,e),e?this.updateInteractionFeatures_():this.reset_()}},{key:"updateInteractionFeatures_",value:function(){return this.features_.getLength()?(this.featuresExtent_=d(this.features_),this.createOrUpdateAnchorFeature_(),void this.createOrUpdateArrowFeature_()):void this.reset_()}},{key:"reset_",value:function(){var e=this;[this.anchorFeature_,this.arrowFeature_].forEach(function(t){t&&e.overlay_.getSource().removeFeature(t)}),this.anchorFeature_=this.arrowFeature_=this.lastCoordinate_=this.featuresExtent_=void 0,this.anchorMoving_=!1}},{key:"createOrUpdateAnchorFeature_",value:function(){var e,t,r=this,n=this.features_.item(0);if(n&&(t=n.get(this.angleProperty_)||0,e=n.get(this.anchorProperty_)),e&&e.length||(e=_["default"].extent.getCenter(this.featuresExtent_)),this.anchorFeature_)this.anchorFeature_.getGeometry().setCoordinates(e);else{var a;this.anchorFeature_=new _["default"].Feature((a={geometry:new _["default"].geom.Point(e)},o(a,w,!0),o(a,this.angleProperty_,t),a)),this.overlay_.getSource().addFeature(this.anchorFeature_),this.features_.forEach(function(t){return t.set(r.anchorProperty_,e)})}}},{key:"createOrUpdateArrowFeature_",value:function(){var e,t,r=this.features_.item(0);if(r&&(t=r.get(this.angleProperty_)||0,e=r.get(this.anchorProperty_)),e&&e.length||(e=_["default"].extent.getCenter(this.featuresExtent_)),this.arrowFeature_)this.arrowFeature_.getGeometry().setCoordinates(e);else{var n;this.arrowFeature_=new _["default"].Feature((n={geometry:new _["default"].geom.Point(e)},o(n,b,!0),o(n,this.angleProperty_,t),n)),this.overlay_.getSource().addFeature(this.arrowFeature_)}}},{key:"handleFeatureAdd_",value:function(e){var t=e.element;(0,g.assertInstanceOf)(t,_["default"].Feature),this.updateInteractionFeatures_()}},{key:"handleFeatureRemove_",value:function(e){var t=e.element;(0,g.assertInstanceOf)(t,_["default"].Feature),this.updateInteractionFeatures_()}}],[{key:"handleEvent",value:function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});return["click","singleclick"].includes(e.type)&&t&&[this.anchorFeature_,this.arrowFeature_].includes(t)?!1:_["default"].interaction.Pointer.handleEvent.call(this,e)}}]),t}(_["default"].interaction.Pointer);t["default"]=m},function(e,t){"use strict";function r(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];if(t=["Assertion failed",t].join(": "),!e)throw new Error(t)}function n(e,t){r(e instanceof t,"Expected instanceof "+i(t)+" but got "+i(e)+".")}function o(){}function a(e){return e}function i(e){return e instanceof Function?e.name||"unknown type name":e instanceof Object?e.constructor.name||Object.prototype.toString.call(e):null===e?"null":"undefined"==typeof e?"undefined":u(e)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.assert=r,t.assertInstanceOf=n,t.noop=o,t.identity=a,t.getValueType=i},function(t,r){t.exports=e}])});