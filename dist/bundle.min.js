/*!
 * Rotate vector features interaction for OpenLayers
 * 
 * @package ol-rotate-feature
 * @author Vladimir Vershinin <ghettovoice@gmail.com>
 * @version 1.2.4
 * @licence MIT
 * @copyright (c) 2016-2017, Vladimir Vershinin <ghettovoice@gmail.com>
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("openlayers")):"function"==typeof define&&define.amd?define(["openlayers"],t):"object"==typeof exports?exports.RotateFeature=t(require("openlayers")):(e.ol=e.ol||{},e.ol.interaction=e.ol.interaction||{},e.ol.interaction.RotateFeature=t(e.ol))}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3);t.default=n.a},function(e,t,r){var n=r(0).default;e.exports=n},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"b",function(){return a});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a={START:"rotatestart",ROTATING:"rotating",END:"rotateend"},i=function(){function e(t,r,o,a){n(this,e),this.propagationStopped_=!1,this.type_=t,this.features_=r,this.angle_=o,this.anchor_=a}return o(e,[{key:"preventDefault",value:function(){this.propagationStopped_=!0}},{key:"stopPropagation",value:function(){this.propagationStopped_=!0}},{key:"propagationStopped",get:function(){return this.propagationStopped_}},{key:"type",get:function(){return this.type_}},{key:"features",get:function(){return this.features_}},{key:"angle",get:function(){return this.angle_}},{key:"anchor",get:function(){return this.anchor_}}]),e}();t.a=i},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=e.map.forEachFeatureAtPixel(e.pixel,d.c);return(!r.i(d.d)(["click","singleclick","dblclick"],e.type)||!r.i(d.d)([this.anchorFeature_,this.arrowFeature_],t))&&y.a.interaction.Pointer.handleEvent.call(this,e)}function u(e){var t=e.map.forEachFeatureAtPixel(e.pixel,d.c);return!t||this.lastCoordinate_||!r.i(d.d)(this.features_.getArray(),t)&&t!==this.arrowFeature_?!(!t||t!==this.anchorFeature_)&&(this.anchorMoving_=!0,h.call(this,e),!0):(this.lastCoordinate_=e.coordinate,h.call(this,e),this.dispatchRotateStartEvent_(this.features_),!0)}function c(e){return this.lastCoordinate_?(this.lastCoordinate_=void 0,h.call(this,e),this.dispatchRotateEndEvent_(this.features_),!0):!!this.anchorMoving_&&(this.anchorMoving_=!1,h.call(this,e),!0)}function l(e){var t=e.coordinate,r=this.anchorFeature_.getGeometry().getCoordinates();if(this.lastCoordinate_){var n=[this.lastCoordinate_[0]-r[0],this.lastCoordinate_[1]-r[1]],o=[t[0]-r[0],t[1]-r[1]],a=Math.atan2(n[0]*o[1]-o[0]*n[1],n[0]*o[0]+n[1]*o[1]);this.setAngle(this.getAngle()+a),this.dispatchRotatingEvent_(this.features_),this.lastCoordinate_=t}else this.anchorMoving_&&this.setAnchor(t)}function h(e){var t=e.map,n=e.pixel,o=t.getTargetElement(),a=t.forEachFeatureAtPixel(n,d.c),i=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(o.style.cursor="-webkit-"+e,o.style.cursor="-moz-"+e),o.style.cursor=e};this.lastCoordinate_?(this.previousCursor_=o.style.cursor,i("grabbing",!0)):a&&(r.i(d.d)(this.features_.getArray(),a)||a===this.arrowFeature_)?(this.previousCursor_=o.style.cursor,i("grab",!0)):a&&a===this.anchorFeature_||this.anchorMoving_?(this.previousCursor_=o.style.cursor,i("crosshair")):(i(this.previousCursor_||""),this.previousCursor_=void 0)}function f(){var e,t=[255,255,255,.8],r=[0,153,255,.8],o=[255,255,255,.01],a=(e={},n(e,b,[new y.a.style.Style({image:new y.a.style.RegularShape({fill:new y.a.style.Fill({color:[0,153,255,.8]}),stroke:new y.a.style.Stroke({color:r,width:1}),radius:4,points:6}),zIndex:1/0})]),n(e,m,[new y.a.style.Style({fill:new y.a.style.Fill({color:o}),stroke:new y.a.style.Stroke({color:t,width:4}),text:new y.a.style.Text({font:"12px sans-serif",offsetX:20,offsetY:-20,fill:new y.a.style.Fill({color:"blue"}),stroke:new y.a.style.Stroke({color:t,width:3})}),zIndex:1/0}),new y.a.style.Style({fill:new y.a.style.Fill({color:o}),stroke:new y.a.style.Stroke({color:r,width:2}),zIndex:1/0})]),e);return function(e,t){var r=void 0,n=e.get(k)||0;switch(!0){case e.get(b):return r=a[b],r[0].getImage().setRotation(-n),r;case e.get(m):r=a[m];var o=e.getGeometry().getCoordinates(),i=new y.a.geom.Polygon([[[o[0],o[1]-6*t],[o[0]+8*t,o[1]-12*t],[o[0],o[1]+30*t],[o[0]-8*t,o[1]-12*t],[o[0],o[1]-6*t]]]);return i.rotate(n,o),r[0].setGeometry(i),r[1].setGeometry(i),r[0].getText().setText(Math.round(180*-n/Math.PI)+"Â°"),r}}}function g(e){if(e=e instanceof y.a.Collection?e.getArray():e,e.length)return new y.a.geom.GeometryCollection(e.map(function(e){return e.getGeometry()})).getExtent()}function p(e){if(e=e instanceof y.a.Collection?e.getArray():e,e.length)return y.a.extent.getCenter(g(e))}var _=r(5),y=r.n(_),d=r(4),v=r(2),A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),F=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in o)return o.value;var i=o.get;if(void 0!==i)return i.call(n)},b="rotate-anchor",m="rotate-arrow",k="angle",C="anchor",O=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{handleEvent:s,handleDownEvent:u,handleUpEvent:c,handleDragEvent:l,handleMoveEvent:h}));if(n.previousCursor_=void 0,n.anchorFeature_=void 0,n.arrowFeature_=void 0,n.lastCoordinate_=void 0,n.anchorMoving_=!1,n.overlay_=new y.a.layer.Vector({style:e.style||f(),source:new y.a.source.Vector({features:new y.a.Collection})}),n.features_=void 0,e.features)if(r.i(d.a)(e.features))n.features_=new y.a.Collection(e.features);else{if(!(e.features instanceof y.a.Collection))throw new Error("Features option should be an array or collection of features, got "+A(e.features));n.features_=e.features}else n.features_=new y.a.Collection;return n.setAnchor(e.anchor||p(n.features_)),n.setAngle(e.angle||0),n.features_.on("add",n.onFeatureAdd_.bind(n)),n.features_.on("remove",n.onFeatureRemove_.bind(n)),n.on("change:"+k,n.onAngleChange_.bind(n)),n.on("change:"+C,n.onAnchorChange_.bind(n)),n.createOrUpdateAnchorFeature_(),n.createOrUpdateArrowFeature_(),n}return i(t,e),w(t,[{key:"setMap",value:function(e){this.overlay_.setMap(e),F(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setMap",this).call(this,e)}},{key:"setActive",value:function(e){this.overlay_&&this.overlay_.setMap(e?this.map:void 0),F(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setActive",this).call(this,e)}},{key:"setAngle",value:function(e){r.i(d.b)(!isNaN(parseFloat(e)),"Numeric value passed"),this.set(k,parseFloat(e))}},{key:"getAngle",value:function(){return this.get(k)}},{key:"setAnchor",value:function(e){r.i(d.b)(null==e||r.i(d.a)(e)&&2===e.length,"Array of two elements passed"),this.set(C,null!=e?e.map(parseFloat):p(this.features_))}},{key:"getAnchor",value:function(){return this.get(C)}},{key:"createOrUpdateAnchorFeature_",value:function(){var e=this.getAngle(),t=this.getAnchor();if(t)if(this.anchorFeature_)this.anchorFeature_.getGeometry().setCoordinates(t),this.anchorFeature_.set(k,e);else{var r;this.anchorFeature_=new y.a.Feature((r={geometry:new y.a.geom.Point(t)},n(r,k,e),n(r,b,!0),r)),this.overlay_.getSource().addFeature(this.anchorFeature_)}}},{key:"createOrUpdateArrowFeature_",value:function(){var e=this.getAngle(),t=this.getAnchor();if(t)if(this.arrowFeature_)this.arrowFeature_.getGeometry().setCoordinates(t),this.arrowFeature_.set(k,e);else{var r;this.arrowFeature_=new y.a.Feature((r={geometry:new y.a.geom.Point(t)},n(r,k,e),n(r,m,!0),r)),this.overlay_.getSource().addFeature(this.arrowFeature_)}}},{key:"resetAngleAndAnchor_",value:function(){this.resetAngle_(),this.resetAnchor_()}},{key:"resetAngle_",value:function(){this.set(k,0,!0),this.arrowFeature_&&this.arrowFeature_.set(k,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(k,this.getAngle())}},{key:"resetAnchor_",value:function(){this.set(C,p(this.features_),!0),this.getAnchor()&&(this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(this.getAnchor()),this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(this.getAnchor()))}},{key:"onFeatureAdd_",value:function(){this.resetAngleAndAnchor_(),this.createOrUpdateAnchorFeature_(),this.createOrUpdateArrowFeature_()}},{key:"onFeatureRemove_",value:function(){this.resetAngleAndAnchor_(),this.features_.getLength()?(this.createOrUpdateAnchorFeature_(),this.createOrUpdateArrowFeature_()):(this.overlay_.getSource().clear(),this.anchorFeature_=this.arrowFeature_=void 0)}},{key:"onAngleChange_",value:function(e){var t=this,r=e.oldValue;this.features_.forEach(function(e){return e.getGeometry().rotate(t.getAngle()-r,t.getAnchor())}),this.arrowFeature_&&this.arrowFeature_.set(k,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(k,this.getAngle())}},{key:"onAnchorChange_",value:function(){var e=this.getAnchor();e&&(this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(e),this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(e))}},{key:"dispatchRotateStartEvent_",value:function(e){this.dispatchEvent(new v.a(v.b.START,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotatingEvent_",value:function(e){this.dispatchEvent(new v.a(v.b.ROTATING,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotateEndEvent_",value:function(e){this.dispatchEvent(new v.a(v.b.END,e,this.getAngle(),this.getAnchor()))}},{key:"features",get:function(){return this.features_}},{key:"angle",get:function(){return this.getAngle()},set:function(e){this.setAngle(e)}},{key:"anchor",get:function(){return this.getAnchor()},set:function(e){this.setAnchor(e)}},{key:"map",set:function(e){this.setMap(e)},get:function(){return this.getMap()}},{key:"active",set:function(e){this.setActive(e)},get:function(){return this.getActive()}}]),t}(y.a.interaction.Pointer);t.a=O},function(e,t,r){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t=["Assertion failed",t].join(": "),!e)throw new Error(t)}function o(e){return e}function a(e,t){return-1!==e.indexOf(t)}function i(e){return"[object Array]"===Object.prototype.toString.call(e)}t.b=n,t.c=o,t.d=a,t.a=i},function(t,r){t.exports=e}])});
//# sourceMappingURL=bundle.min.js.map